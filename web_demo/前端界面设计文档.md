# Cascade VAD Web演示界面 - 前端界面设计文档

## 1. 界面总体设计

### 1.1 设计理念

- **直观易用** - 简洁清晰的界面，突出核心功能
- **实时反馈** - 音频处理结果和性能指标的实时可视化
- **响应式布局** - 适配不同设备和屏幕尺寸
- **专业美观** - 现代化UI设计，专业的数据可视化

### 1.2 页面布局

```
+-------------------------------------------------------+
|                      导航栏/标题                       |
+-------------------------------------------------------+
|                         |                             |
|                         |                             |
|       控制面板          |        结果显示区域          |
|    (参数配置区)         |     (波形图/语音段显示)      |
|                         |                             |
|                         |                             |
+-------------------------------------------------------+
|                  性能监控与统计区域                    |
+-------------------------------------------------------+
|                        页脚                           |
+-------------------------------------------------------+
```

### 1.3 色彩方案

- **主色调**: #3498db (蓝色) - 专业、技术感
- **辅助色**: #2ecc71 (绿色) - 成功状态
- **警告色**: #e74c3c (红色) - 错误状态
- **中性色**: #ecf0f1 (浅灰) - 背景
- **强调色**: #f39c12 (橙色) - 高亮语音段

### 1.4 字体选择

- **标题**: 'Roboto', sans-serif (粗体)
- **正文**: 'Open Sans', sans-serif
- **代码/数据**: 'Fira Mono', monospace

## 2. 核心组件设计

### 2.1 导航栏/标题区

```
+-------------------------------------------------------+
| Cascade VAD演示 [logo]        [帮助] [关于] [设置]    |
+-------------------------------------------------------+
```

**功能**:
- 项目标识和名称
- 帮助文档入口
- 关于项目信息
- 全局设置选项

### 2.2 控制面板

```
+---------------------------+
|     音频输入控制          |
|  [开始录音] [停止录音]    |
|  [麦克风选择▼]            |
|  [音量指示器▮▮▮▮▮▯▯▯]    |
+---------------------------+
|     文件上传              |
|  [选择文件] 或 拖放区域   |
|  支持格式: WAV, MP3       |
|  最大大小: 50MB           |
+---------------------------+
|     VAD参数设置           |
|  阈值: [0.5] [▁▂▃▄▅▆▇█]   |
|  块大小: [512ms▼]         |
|  重叠: [32ms▼]            |
|  线程数: [4▼]             |
|  后端: [Silero▼]          |
+---------------------------+
|  [应用设置] [重置默认]    |
+---------------------------+
```

**功能**:
- 麦克风录音控制
- 文件上传区域
- VAD参数调整
- 设置应用和重置

### 2.3 结果显示区域

```
+------------------------------------------+
|  [实时模式▼]  [自动滚动✓]  [导出结果]    |
+------------------------------------------+
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |        音频波形图显示区域          |  |
|  |    (带语音段高亮和时间标记)        |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  语音段列表:                             |
|  +------------------------------------+  |
|  | #  | 开始时间 | 结束时间 | 置信度  |  |
|  |----|----------|----------|---------|  |
|  | 1  | 0.52s    | 2.31s    | 0.87    |  |
|  | 2  | 3.45s    | 5.67s    | 0.92    |  |
|  +------------------------------------+  |
|                                          |
|  状态: [●] 正在处理...                   |
+------------------------------------------+
```

**功能**:
- 音频波形可视化
- 语音段高亮显示
- 语音段列表
- 处理状态指示

### 2.4 性能监控区域

```
+-------------------------------------------------------+
|  性能指标:  [实时▼]  [最近1分钟▼]  [自动刷新✓]        |
+-------------------------------------------------------+
|                      |                |                |
|   延迟图表           |  吞吐量图表    |  资源使用图表  |
|  (毫秒/块)           |  (块/秒)       |  (CPU/内存)    |
|                      |                |                |
+-------------------------------------------------------+
|  平均延迟: 2.3ms  |  吞吐量: 45.2块/秒  |  CPU: 28%    |
+-------------------------------------------------------+
```

**功能**:
- 实时延迟监控
- 吞吐量统计
- 资源使用监控
- 关键指标数值显示

### 2.5 页脚区域

```
+-------------------------------------------------------+
| Cascade VAD演示 v0.1.0 | 文档 | GitHub | 问题反馈     |
+-------------------------------------------------------+
```

**功能**:
- 版本信息
- 文档链接
- 源码仓库链接
- 问题反馈入口

## 3. 交互设计

### 3.1 麦克风录音流程

1. **初始状态**:
   - 显示"开始录音"按钮
   - 麦克风选择下拉菜单可用

2. **点击"开始录音"**:
   - 请求麦克风权限(如果未授权)
   - 按钮变为"停止录音"
   - 音量指示器开始显示实时音量
   - 波形图开始实时显示音频
   - WebSocket连接建立

3. **录音过程中**:
   - 实时显示音频波形
   - 实时高亮显示检测到的语音段
   - 语音段列表实时更新
   - 性能指标实时更新

4. **点击"停止录音"**:
   - 停止录音
   - 按钮变回"开始录音"
   - 波形图停止更新
   - WebSocket连接关闭

### 3.2 文件上传流程

1. **选择文件**:
   - 点击"选择文件"按钮或拖放文件到上传区域
   - 显示文件名和大小
   - 显示"上传"按钮

2. **上传过程**:
   - 显示上传进度条
   - 显示"取消"按钮

3. **处理过程**:
   - 显示处理进度
   - 波形图显示整个文件音频
   - 处理完成后高亮显示所有检测到的语音段
   - 更新语音段列表
   - 显示性能统计

### 3.3 参数调整交互

1. **调整阈值**:
   - 滑块控制(0.1-0.9)
   - 实时显示当前值
   - 实时更新结果(如果在录音或处理中)

2. **选择块大小**:
   - 下拉选择(256ms, 512ms, 1024ms)
   - 更改后需点击"应用设置"

3. **选择重叠大小**:
   - 下拉选择(16ms, 32ms, 64ms)
   - 更改后需点击"应用设置"

4. **调整线程数**:
   - 下拉选择(1-8)
   - 更改后需点击"应用设置"

5. **选择后端**:
   - 下拉选择(Silero, ONNX)
   - 更改后需点击"应用设置"

### 3.4 结果查看交互

1. **波形图交互**:
   - 鼠标悬停显示时间点
   - 滚轮缩放时间轴
   - 拖动平移视图
   - 点击语音段跳转到对应位置

2. **语音段列表交互**:
   - 点击列表项高亮对应波形区域
   - 排序功能(按开始时间、持续时间、置信度)
   - 过滤功能(仅显示高置信度段)

3. **导出功能**:
   - 导出为JSON
   - 导出为CSV
   - 导出为文本时间轴

## 4. 响应式设计

### 4.1 桌面布局 (>1200px)

- 完整双列布局
- 控制面板和结果显示区并排
- 完整性能监控区域

### 4.2 平板布局 (768px-1199px)

- 控制面板和结果显示区并排，但宽度比例调整
- 性能监控区域图表并排显示两个，第三个折叠

### 4.3 手机布局 (<767px)

- 单列布局，控制面板在上，结果显示区在下
- 简化的波形图显示
- 性能监控区域图表垂直堆叠
- 折叠部分高级选项

## 5. 动画与过渡效果

### 5.1 页面加载动画

- 渐显加载页面元素
- 波形图区域加载动画

### 5.2 录音状态过渡

- 平滑过渡录音按钮状态
- 波形图绘制动画

### 5.3 语音段高亮效果

- 语音段检测到时的高亮动画
- 点击语音段列表项时的聚焦动画

### 5.4 性能图表更新

- 平滑的图表数据更新动画
- 数值变化过渡效果

## 6. 组件技术实现

### 6.1 音频波形图组件

**技术选择**: Canvas API

**核心功能**:
```javascript
class WaveformVisualizer {
  constructor(canvasElement, options) {
    this.canvas = canvasElement;
    this.ctx = this.canvas.getContext('2d');
    this.options = {
      waveColor: '#3498db',
      speechColor: '#f39c12',
      backgroundColor: '#ecf0f1',
      timeScale: 100, // 像素/秒
      ...options
    };
    this.audioData = [];
    this.speechSegments = [];
  }
  
  // 添加音频数据
  addAudioData(data) {
    this.audioData.push(...data);
    this.render();
  }
  
  // 添加语音段
  addSpeechSegment(segment) {
    this.speechSegments.push(segment);
    this.render();
  }
  
  // 渲染波形
  render() {
    // 清空画布
    this.ctx.fillStyle = this.options.backgroundColor;
    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
    
    // 绘制波形
    this.drawWaveform();
    
    // 高亮语音段
    this.highlightSpeechSegments();
    
    // 绘制时间轴
    this.drawTimeAxis();
  }
  
  // 其他方法...
}
```

### 6.2 WebSocket通信组件

**技术选择**: 原生WebSocket API

**核心功能**:
```javascript
class AudioStreamManager {
  constructor(wsUrl, options) {
    this.wsUrl = wsUrl;
    this.options = {
      reconnectAttempts: 3,
      reconnectDelay: 1000,
      ...options
    };
    this.ws = null;
    this.isRecording = false;
    this.sequenceNumber = 0;
    this.eventHandlers = {};
  }
  
  // 连接WebSocket
  connect() {
    this.ws = new WebSocket(this.wsUrl);
    
    this.ws.onopen = () => {
      this.triggerEvent('connected');
    };
    
    this.ws.onmessage = (event) => {
      const message = JSON.parse(event.data);
      this.handleMessage(message);
    };
    
    this.ws.onclose = () => {
      this.triggerEvent('disconnected');
      this.attemptReconnect();
    };
    
    this.ws.onerror = (error) => {
      this.triggerEvent('error', error);
    };
  }
  
  // 发送音频数据
  sendAudioChunk(audioData) {
    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) return;
    
    const message = {
      type: 'audio_chunk',
      data: Array.from(audioData),
      timestamp: Date.now(),
      sequence: this.sequenceNumber++
    };
    
    this.ws.send(JSON.stringify(message));
  }
  
  // 其他方法...
}
```

### 6.3 麦克风录音组件

**技术选择**: WebRTC getUserMedia API + Web Audio API

**核心功能**:
```javascript
class MicrophoneRecorder {
  constructor(options) {
    this.options = {
      sampleRate: 16000,
      channelCount: 1,
      bufferSize: 4096,
      ...options
    };
    this.mediaStream = null;
    this.audioContext = null;
    this.processor = null;
    this.isRecording = false;
    this.onAudioProcess = null;
  }
  
  // 初始化麦克风
  async initialize() {
    try {
      // 请求麦克风权限
      this.mediaStream = await navigator.mediaDevices.getUserMedia({
        audio: {
          sampleRate: this.options.sampleRate,
          channelCount: this.options.channelCount,
          echoCancellation: true,
          noiseSuppression: true
        }
      });
      
      // 创建音频上下文
      this.audioContext = new AudioContext({
        sampleRate: this.options.sampleRate
      });
      
      // 创建音频处理节点
      const source = this.audioContext.createMediaStreamSource(this.mediaStream);
      this.processor = this.audioContext.createScriptProcessor(
        this.options.bufferSize, 1, 1
      );
      
      // 设置音频处理回调
      this.processor.onaudioprocess = (event) => {
        if (this.isRecording && this.onAudioProcess) {
          const audioData = event.inputBuffer.getChannelData(0);
          this.onAudioProcess(audioData);
        }
      };
      
      // 连接节点
      source.connect(this.processor);
      this.processor.connect(this.audioContext.destination);
      
      return true;
    } catch (error) {
      console.error('麦克风初始化失败:', error);
      return false;
    }
  }
  
  // 开始录音
  start() {
    if (!this.audioContext || !this.processor) return false;
    
    this.isRecording = true;
    if (this.audioContext.state === 'suspended') {
      this.audioContext.resume();
    }
    
    return true;
  }
  
  // 停止录音
  stop() {
    this.isRecording = false;
    
    if (this.processor) {
      this.processor.disconnect();
    }
    
    if (this.mediaStream) {
      this.mediaStream.getTracks().forEach(track => track.stop());
    }
  }
}
```

### 6.4 性能监控图表组件

**技术选择**: Chart.js

**核心功能**:
```javascript
class PerformanceMonitor {
  constructor(options) {
    this.options = {
      maxDataPoints: 100,
      updateInterval: 1000,
      ...options
    };
    
    this.metrics = {
      latency: [],
      throughput: [],
      cpuUsage: [],
      memoryUsage: []
    };
    
    this.charts = {
      latency: null,
      throughput: null,
      resources: null
    };
    
    this.lastUpdate = Date.now();
  }
  
  // 初始化图表
  initializeCharts(latencyCanvas, throughputCanvas, resourcesCanvas) {
    // 延迟图表
    this.charts.latency = new Chart(latencyCanvas, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: '处理延迟 (ms)',
          data: [],
          borderColor: '#3498db',
          tension: 0.2
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
    
    // 吞吐量图表
    // ...
    
    // 资源使用图表
    // ...
  }
  
  // 更新指标
  updateMetrics(metrics) {
    const now = Date.now();
    
    // 添加新数据点
    this.metrics.latency.push({
      time: now,
      value: metrics.avg_latency_ms
    });
    
    this.metrics.throughput.push({
      time: now,
      value: metrics.throughput_chunks_per_sec
    });
    
    this.metrics.cpuUsage.push({
      time: now,
      value: metrics.cpu_usage
    });
    
    this.metrics.memoryUsage.push({
      time: now,
      value: metrics.memory_usage_mb
    });
    
    // 限制数据点数量
    this.limitDataPoints();
    
    // 更新图表
    this.updateCharts();
    
    this.lastUpdate = now;
  }
  
  // 其他方法...
}
```

## 7. 辅助功能设计

### 7.1 键盘快捷键

| 快捷键 | 功能 |
|-------|------|
| Space | 开始/停止录音 |
| Ctrl+O | 打开文件 |
| Ctrl+S | 导出结果 |
| Ctrl+Z | 撤销操作 |
| Ctrl+R | 重置设置 |
| F1 | 显示帮助 |

### 7.2 无障碍设计

- 符合WCAG 2.1 AA标准
- 适当的颜色对比度
- 键盘导航支持
- 屏幕阅读器兼容性
- 焦点状态清晰可见

### 7.3 错误处理与提示

- 友好的错误提示
- 操作确认对话框
- 状态变化通知
- 加载状态指示器

### 7.4 帮助系统

- 上下文帮助提示
- 功能说明工具提示
- 完整帮助文档
- 快速入门指南

## 8. 浏览器兼容性

### 8.1 支持的浏览器

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 8.2 功能降级策略

- WebRTC不可用时提供文件上传替代方案
- Canvas不可用时使用表格显示结果
- WebSocket不可用时使用HTTP轮询

### 8.3 移动设备支持

- 触摸友好的控件
- 适应小屏幕的布局
- 针对移动设备的性能优化

## 9. 实现路线图

### 9.1 前端实现步骤

1. **基础框架搭建**
   - HTML页面结构
   - CSS样式框架
   - JavaScript模块化结构

2. **核心组件实现**
   - 波形图可视化
   - WebSocket通信
   - 麦克风录音

3. **UI组件实现**
   - 控制面板
   - 结果显示区
   - 性能监控区

4. **交互功能实现**
   - 参数调整
   - 文件上传
   - 结果导出

5. **性能优化**
   - 渲染性能优化
   - 内存使用优化
   - 网络通信优化

6. **测试与调试**
   - 跨浏览器测试
   - 响应式布局测试
   - 性能压力测试

## 10. 设计资源

### 10.1 UI组件库

- Bootstrap 5.3
- Font Awesome 6

### 10.2 JavaScript库

- Chart.js 4.x
- FileSaver.js

### 10.3 设计资源

- 图标: Material Design Icons
- 字体: Google Fonts (Roboto, Open Sans, Fira Mono)
- 配色: Material Design Color System